(function(d){var b=function(f){var g=a(f),i=d(".star",g),n=d(".cancel",g),j=d(".fivestar-summary",f),k=0,t=j.html(),u=f.is(".fivestar-labels-hover"),r=d("select",f).val(),l=d("label",f).html(),p=l!=Drupal.settings.fivestar.titleAverage?l:Drupal.settings.fivestar.titleUser,q=false;if(f.is(".fivestar-user-stars")){var m="user"}else{if(f.is(".fivestar-average-stars")){var m="average";r=d("input[name=vote_average]",f).val()}else{if(f.is(".fivestar-combo-stars")){var m="combo"}else{var m="none"}}}if(f.is(".fivestar-smart-stars")){var m="smart"}if(j.size()){var o=j.attr("class").replace(/.*?fivestar-summary-([^ ]+).*/,"$1").replace(/-/g,"_")}else{var o="none"}i.mouseover(function(){h.drain();h.fill(this)}).mouseout(function(){h.drain();h.reset()});i.children().focus(function(){h.drain();h.fill(this.parentNode)}).blur(function(){h.drain();h.reset()}).end();n.mouseover(function(){h.drain();d(this).addClass("on")}).mouseout(function(){h.reset();d(this).removeClass("on")});n.children().focus(function(){h.drain();d(this.parentNode).addClass("on")}).blur(function(){h.reset();d(this.parentNode).removeClass("on")}).end();n.click(function(){r=0;h.reset();q=false;if(d("input.fivestar-path",f).size()&&j.is(".fivestar-feedback-enabled")){s(Drupal.settings.fivestar.feedbackDeletingVote)}d("select",f).val(0);l=m!="smart"?l:Drupal.settings.fivestar.titleAverage;d("label",f).html(l);if(f.is(".fivestar-smart-text")){f.removeClass("fivestar-user-text").addClass("fivestar-average-text");j[0].className=j[0].className.replace(/-user/,"-average");o=j.attr("class").replace(/.*?fivestar-summary-([^ ]+).*/,"$1").replace(/-/g,"_")}if(f.is(".fivestar-smart-stars")){f.removeClass("fivestar-user-stars").addClass("fivestar-average-stars")}d("input.fivestar-path",f).each(function(){var w=d("input.fivestar-token",f).val();d.ajax({type:"GET",data:{token:w},dataType:"xml",url:this.value+"/"+0,success:v})});return false});i.click(function(){r=d("select option",f).get(i.index(this)+n.size()+1).value;d("select",f).val(r);q=true;h.reset();if(d("input.fivestar-path",f).size()&&j.is(".fivestar-feedback-enabled")){s(Drupal.settings.fivestar.feedbackSavingVote)}if(f.is(".fivestar-smart-text")){f.removeClass("fivestar-average-text").addClass("fivestar-user-text");j[0].className=j[0].className.replace(/-average/,"-user");o=j.attr("class").replace(/.*?fivestar-summary-([^ ]+).*/,"$1").replace(/-/g,"_")}if(f.is(".fivestar-smart-stars")){f.removeClass("fivestar-average-stars").addClass("fivestar-user-stars")}d("input.fivestar-path",f).each(function(){var w=d("input.fivestar-token",f).val();d.ajax({type:"GET",data:{token:w},dataType:"xml",url:this.value+"/"+r,success:v})});return false});var h={fill:function(y){var x=i.index(y)+1;i.children("a").css("width","100%").end().filter(":lt("+x+")").addClass("hover").end();if(u&&!k){var w=d("select option",f)[x+n.size()].text;var z=d("select option",f)[x+n.size()].value;j.html(w!=x+1?w:"&nbsp;");d("label",f).html(p)}},drain:function(){i.filter(".on").removeClass("on").end().filter(".hover").removeClass("hover").end();if(u&&!k){var w=d("select option",f)[1].text;j.html((n.size()&&w!=0)?w:"&nbsp");if(!q){d("label",f).html(l)}}},reset:function(){var x=r/100*i.size();var w=(x-Math.floor(x))*100;i.filter(":lt("+Math.floor(x)+")").addClass("on").end();if(w>0){i.eq(Math.floor(x)).addClass("on").children("a").css("width",w+"%").end().end()}if(u&&!k){j.html(t?t:"&nbsp;")}if(q){d("label",f).html(p)}else{d("label",f).html(l)}}};var s=function(w){k=1;j.html(w)};var v=function(x){var w={result:{count:d("result > count",x).text(),average:d("result > average",x).text(),summary:{average:d("summary average",x).text(),average_count:d("summary average_count",x).text(),user:d("summary user",x).text(),user_count:d("summary user_count",x).text(),combo:d("summary combo",x).text(),count:d("summary count",x).text()}},vote:{id:d("vote id",x).text(),tag:d("vote tag",x).text(),type:d("vote type",x).text(),value:d("vote value",x).text()},display:{stars:m,text:o}};if(window.fivestarResult){fivestarResult(w)}else{e(w)}t=w.result.summary[w.display.text];if(d(w.result.summary.average).is(".fivestar-feedback-enabled")){if(w.vote.value!=0){s(Drupal.settings.fivestar.feedbackVoteSaved)}else{s(Drupal.settings.fivestar.feedbackVoteDeleted)}k=setTimeout(function(){clearTimeout(k);k=0;j.html(w.result.summary[w.display.text])},2000)}if(w.vote.value==0&&(m=="average"||m=="smart")){r=w.result.average;h.reset()}};h.reset();return g};var a=function(f){var o=d('<div class="fivestar-widget clear-block"></div>');var l=d("select option",f);var q=d("option",f).size()-1;var p=1;for(var g=1,j;j=l[g];g++){if(j.value=="0"){p=0;$div=d('<div class="cancel"><a href="#0" title="'+j.text+'">'+j.text+"</a></div>")}else{var k=(g+p-1)%2==0?"even":"odd";var m=g+p-1;var h=m==1?" star-first":"";var n=m==q+p-1?" star-last":"";$div=d('<div class="star star-'+m+" star-"+k+h+n+'"><a href="#'+j.value+'" title="'+j.text+'">'+j.text+"</a></div>")}o.append($div[0])}o.addClass("fivestar-widget-"+(q+p-1));d("select",f).after(o).css("display","none");return o};function e(f){d("div.fivestar-summary-"+f.vote.tag+"-"+f.vote.id).html(f.result.summary[f.display.text]);if(f.display.stars=="combo"){d("div.fivestar-form-"+f.vote.id).each(function(){var k=d(".fivestar-widget-static .star span",this);var i=f.result.average/100*k.size();var h=Math.floor(i);k.removeClass("on").addClass("off").css("width","auto");k.filter(":lt("+(h+1)+")").removeClass("off").addClass("on");k.eq(h).css("width",((i-h)*100)+"%");var g=d(".fivestar-static-form-item .fivestar-summary",this);if(g.size()){var j=g.attr("class").replace(/.*?fivestar-summary-([^ ]+).*/,"$1").replace(/-/g,"_");g.html(f.result.summary[j])}})}}d.fn.fivestar=function(){var f=[];this.each(function(){var g=b(d(this));f.push(g)});return f};if(d.browser.msie==true){try{document.execCommand("BackgroundImageCache",false,true)}catch(c){}}Drupal.behaviors.fivestar=function(f){d("div.fivestar-form-item:not(.fivestar-processed)",f).addClass("fivestar-processed").fivestar();d("input.fivestar-submit",f).css("display","none")}})(jQuery);